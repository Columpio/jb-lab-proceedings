\section{Корректность механизма диагностики ошибок}
\subsection{Корректность алгоритма построения префиксов}
В данном разделе приведено доказательство того, что построенные графы префиксов порождают только корректные для соответствующей вершины стека префиксы внутреннего графа. 

\textsc{Теорема 1.} 
\textit{Каждый корректный для GSS-вершины $v$ префикс внутреннего графа, соответствующий пути $P = (V_{1},..,V_{l})$ во внутреннем графе, порождается графом префиксов $v.prefixes$, построенным алгоритмом построения префиксов.}

\textsc{Доказательство.}
Обозначим входную эталонную грамматику через $G$. Пусть $p$~--- строка, образованная терминалами на ребрах пути $P$. Докажем теорему методом математической индукции по $l$~--- количеству вершин в пути $P$.

\textbf{База $l = 1$.} Тогда $p$~--- пустая строка. Так как рассматриваемый префикс внутреннего графа корректен для GSS-вершины $v$, то либо $v$~--- начальная вершина GSS $v_{0}$, либо существует последовательность сверток длины 0, приводящая парсер из начального состояния $v_{0}.state$ в состояние $v.state$. В первом случае $v = v_{0}$, а значит, среди начальных вершин графа префиксов $v.prefixes$ имеется вершина $EOP$. Так как путь в графе префиксов $v.prefixes$, состоящий из единственной начальной вершины $EOP$, сводится к пустой строке, то граф префиксов $v.prefixes$ порождает префикс внутреннего графа, соответствующий пути $P$. Во втором случае в GSS существует путь из вершины $v$ в вершину $v_{0}$, состоящий из обнуляемых ребер $(e_{1},..,e_{a})$. Значит, в графе префиксов $v.prefixes$ существует путь $S = (E_{1},..,E_{a}, EOP)$, где $E_{1}$~--- начальная вершина графа префиксов $v.prefixes$ и $\forall i \in [1,..,a], E_{i}$~--- ассоциируется с обнуляемым ребром  $e_{i}$. Путь $S$ также сводится к пустой строке, следовательно, граф префиксов $v.prefixes$ порождает префикс внутреннего графа, соответствующий пути $P$. База доказана.
% * <Екатерина Вербицкая> 14:33:58 18 May 2016 UTC+0300:
% > то граф префиксов $v.prefixes$ порождает префикс внутреннего графа, соответствующий пути $P$.
% 
% Какой P?
% ^ <Рустам Азимов> 22:55:11 18 May 2016 UTC+0300:
% P - путь из условия, в данном случае P состоит из единственной начальной вершины входного графа

\textbf{Индукционный переход.} Пусть теорема доказана для всех префиксов внутреннего графа, соответствующих путям с количеством вершин не большим $k$, где $k > 0$. Докажем теорему для префикса внутреннего графа, соответствующего пути $P = (V_{1},..,V_{k+1})$.
% * <Екатерина Вербицкая> 15:15:24 18 May 2016 UTC+0300:
% > $(V_{1},..,V_{l})$, где $l = k + 1$.
% Так и написать: $(V_{1},..,V_{k+1})$
% ^ <Екатерина Вербицкая> 18:58:00 18 May 2016 UTC+0300:
% Ну я так и написала, собственно.

Так как рассматриваемый префикс внутреннего графа корректен для GSS-вершины $v$, то непустая строка $p$~--- корректный префикс для грамматики $G$. Значит, получив на вход строку $p$, алгоритм RNGLR обработает все терминалы этой строки и построит GSS, имеющий вершины $(v_{1},..,v_{n})$ на последнем уровне. Причем, $\exists i: v_{i}.state = v.state$. По построению GSS существует хотя бы один путь из вершины $v_{i}$ в начальную GSS-вершину $v_{0}$. Пусть $Q = (w_{1},..,w_{m})$~--- один из таких путей, где $w_{1} = v_{i}$, а $w_{m} = v_{0}$. Рассмотрим ребро $e = (w_{1}, w_{2})$. Ребро $e$ может быть терминальным, нетерминальным или обнуляемым.
% * <Екатерина Вербицкая> 15:31:05 18 May 2016 UTC+0300:
% > где $w_{1} = v_{i}$, а $w_{m} = v_{0}$
% Какой в этом глубинный смысл?
% ^ <Екатерина Вербицкая> 18:58:18 18 May 2016 UTC+0300:
% Я поняла, какой в этом глубинный смысл, но не вижу в этом смысла.
% ^ <Рустам Азимов> 22:59:43 18 May 2016 UTC+0300:
% Показалось так проще путь в GSS обозначить. Удобнее путь перечислять, когда индексы есть.

Если $e$~--- терминальное ребро, то пусть оно ассоциировано с терминалом $t$, нагруженным на ребро $(V_{k}, V_{k+1})$ внутреннего графа. Префикс внутреннего графа, соответствующий пути $P' = (V_{1},..,V_{k})$, корректен в силу корректности префикса, соответствующего пути $P$. То есть в вершине внутреннего графа $V_{k+1}$ существуют вершины GSS $(u_{1},..,u_{b})$, для которых префикс внутреннего графа, соответствующий $P'$, корректен. Тогда $\exists j \in [1,..,b]: u_{j}.state = w_{2}.state$. По индукционному предположению префикс внутреннего графа, соответствующий пути $P'$, порождается графом префиксов $u_{j}.prefixes$. Следовательно, существует путь $R = (R_{1},..,R_{c}, EOP)$ графа префиксов $u_{j}.prefixes$, где $R_{1}$~--- начальная вершина графа префиксов, такой, что путь $R$ сводится к строке $p'$, где $p'$~--- строка $p$ без последнего терминала $t$. Так как в построенном RNGLR-алгоритмом GSS присутствует ребро $e = (w_{1}, w_{2})$, то в управляющих таблицах, соответствующих грамматике $G$, существует операция сдвига по терминалу $t$ из состояния $w_{2}.state$  в состояние $w_{1}.state$. Значит, при обработке основным анализом GSS-вершины $u_{j}$ будет добавлено ребро $e' = (v, u_{j})$, т.к. $u_{j}.state = w_{2}.state$ и $v.state = w_{1}.state$. Значит, в граф префиксов $v.prefixes$ будет добавлена начальная вершина $E'$, соответствующая терминальному ребру $e' = (v, u_{j})$ и соединенная с графом префиксов $u_{j}.prefixes$. Поэтому в графе префиксов $v.prefixes$ существует путь $R' = (E',R_{1},..,R{c},EOP)$, который сводится к строке $p$. Таким образом, граф префиксов $v.prefixes$ порождает префикс внутреннего графа, соответствующий пути $P$.

Если $e$~--- нетерминальное ребро, то пусть оно ассоциировано с нетерминалом $N$ и путями GSS $(P_{1},..,P_{d})$. Пусть в GSS, сконструированным RNGLR-алгоритмом, вершина $w_{2}$ была создана после обработки первых $s < k$ терминалов строки $p$. Обозначим через $p_{1}$ строку, составленную из первых $s$ терминалов строки $p$, а через $p_{2}$~--- строку, составленную из последних $(k - s)$ терминалов строки $p$. Так как префикс, соответствующий пути $P_{s} = (V_{1},..,V_{s+1})$~--- корректен, то в вершине $V_{s+1}$ существует GSS-вершина $h$ такая, что этот префикс корректен для GSS-вершины $h$ и $h.state = w_{2}.state$. Количество вершин пути $P_{s}$ равно $(s + 1)$, что не превышает $k$, поэтому по индукционному предположению префикс внутреннего графа, соответствующий пути $P_{s}$, порождается графом префиксов $h.prefixes$.  Значит, существует путь $R = (R_{1},..,R_{c},EOP)$ в графе префиксов $h.prefixes$, где $R_{1}$~--- начальная вершина графа префиксов, такой, что путь $R$ сводится к строке $p_{1}$. В GSS, построенном RNGLR-алгоритмом, имеется нетерминальное ребро $e$, значит, в GSS, построенным основным анализом, имеется нетерминальное ребро $e' = (v, h)$, ассоциированное с нетерминалом $N$, так как $h.state = w_{2}.state$ и $v.state = w_{1}.state$. Значит, в граф префиксов $v.prefixes$ будет добавлена вершина $E'$, ассоциированная с нетерминальным ребром $e'$. Среди путей GSS, ассоциированных с ребром $e'$, будут также присутствовать пути, аналогичные путям $(P_{1},..,P_{d})$ (последовательности состояний вершин GSS в таких путях совпадают, соответствующие ребра будут иметь одинаковый вид, соответствующие терминальные ребра будут ассоциированы с одинаковыми терминалами, а соответствующие нетерминальные ребра~--- с одинаковыми нетерминалами). Так как в GSS, построенном RNGLR-алгоритмом, нет циклов (кроме циклов, состоящих только из обнуляемых ребер), а количество ребер конечно, тo из нетерминального ребра $e$ с помощью конечного числа раскрытий можно получить последовательность терминальных ребер, соответствующих строке $p_{2}$. Значит и в GSS, построенном основным анализом, можно с помощью аналогичного конечного числа раскрытий из ребра $e'$ получить последовательность терминальных ребер, соответствующих строке $p_{2}$. Таким образом, в графе префиксов $v.prefixes$ существует путь $(E',R_{1},..,R_{c},EOP)$, который сводится к строке $p$. Следовательно граф префиксов $v.prefixes$ порождает префикс внутреннего графа, соответствующий пути $P$.
% * <Екатерина Вербицкая> 17:35:28 18 May 2016 UTC+0300:
% > соответствующие ребра будут иметь одинаковый вид,
% 
% Что такое одинаковый вид у ребер?
% ^ <Рустам Азимов> 23:00:27 18 May 2016 UTC+0300:
% когда я говорил про обнуляемые, терминальные и нетерминальные ребра я говорил что будет делить на три вида

Если $e$~--- обнуляемое ребро, обозначим $e_{f} = (w_{f}, w_{f+1})$~--- первое не обнуляемое ребро в пути $Q$. Префикс внутреннего графа, соответствующий пути $P$, является корректным для GSS-вершины $w_{f}$. Граф префиксов $w_{f}.prefixes$ порождает префикс внутреннего графа, соответствующий пути $P$, так как в GSS, построенном RNGLR-алгоритмом, существует путь из вершины $w_{f}$, который начинается с терминального или нетерминального ребра, а такие случаи уже рассмотрены. Пусть $(F_{1},..,F_{g},EOP)$~--- путь графа префиксов $w_{f}.prefixes$, который сводится к строке $p$. Тогда $\exists (Z_{1},..,Z_{f-1},F_{1},..,F_{g},EOP)$~--- путь графа префиксов $w_{1}.prefixes$, где $\forall j \in [1,..,(f-1)], Z_{j}$ ассоциируется с обнуляемым ребром $(w_{j}, w_{j+1})$. Значит, этот путь также сводится к строке $p$. А так как $w_{1}.state = v.state$, то $w_{1} = v$. Следовательно, граф префиксов $v.prefixes$ порождает префикс внутреннего графа, соотвествующий пути $P$. $\square$


Для доказательства того, что каждый префикс внутреннего графа, порождаемый графом префиксов $v.prefixes$, является корректным для GSS-вершины $v$, нам понадобится следующая лемма.


\textsc{Лемма.}
\textit{Пусть GSS-вершина $v_{m}$ корректна для префикса внутреннего графа, соответствующего пути $P_{1} = (V_{1},..,V_{l})$, терминалы на ребрах которого образуют строку $p_{1} = (t_{1},..,t_{l-1})$ ($p_{1} = \epsilon$, если $l = 1$). Пусть $\exists Q = (v_{1},..,v_{m})$~--- путь в GSS, в котором $E = (e_{1},..,e_{m-1})$~--- последовательность ребер, сводящаяся за конечное число раскрытий к строке $p_{2} = (t_{l},..,t_{l+r-1})$ ($p_{2} = \epsilon$, если $r = 0$). Тогда префикс внутреннего графа, соответствующий пути $P = (V_{1},..,V_{l}, V_{l+1},..,V_{l+r})$, корректен для GSS-вершины $v_{1}$, и терминалы на ребрах пути $P$ образуют строку $p = p_{1} \cdot p_{2}$.}
% * <Екатерина Вербицкая> 18:37:38 18 May 2016 UTC+0300:
% > Пусть $\exists Q = (v_{1},..,v_{m})$~--- путь в GSS
% 
% То, что этот путь лежит вдоль всего пути в GSS ни разу не очевидно.

\textsc{Доказательство.}
Докажем лемму методом математической индукции по длине строки $p_{2}$, равной $r$.

\textbf{База $r = 0$ или $r = 1$.} Так как GSS-вершина $v_{m}$ корректна для префикса внутреннего графа, соответствующего пути $P$, то RNGLR-алгоритм, получив на вход строку  $p_{1}$, обработает все терминалы этой строки и на последнем уровне построенного GSS создаст вершину $w_{m}$ такую, что $w_{m}.state = v_{m}.state$.

Если $r = 0$, то строка $p_{2} = \epsilon$, следовательно, $\forall i, e_{i}$~--- обнуляемо. Следовательно, $\forall i, v_{i}$ ассоциировано с $V_{l}$. Таким образом, существует последовательность операций сверток длины 0, приводящих анализатор из состояния $v_{m}.state$ в состояние $v_{1}.state$. Следовательно, в GSS, построенном RNGLR-алгоритмом, в результате применения аналогичной последовательности операций сверток длины 0 на последнем уровне будет существовать путь из обнуляемых ребер, начинающийся в GSS-вершине $w_{1}$ и заканчивающийся в вершине $w_{m}$, где $w_{1}.state = v_{1}.state$. Из существования на последнем уровне GSS, построенного RNGLR-алгоритмом, вершины $w_{1}$ следует, что префикс внутреннего графа, соответствующий пути $P_{1}$, также является корректным и для GSS-вершины $v_{1}$. А так как в данном случае путь $P_{1}$ равен пути $P$, то утверждение леммы при $r = 0$ доказано.

Если $r = 1$, то строка $p_{2}$~--- не пустая, а значит, среди ребер в последовательности $E$ существует ровно одно не обнуляемое ребро. Пусть $j$ такое, что $e_{j} = (v_{j}, v_{j+1})$~--- не обнуляемое ребро последовательности $E$. Если $j = (m - 1)$, то префикс внутреннего графа, соответствующий пути $P_{1}$, корректен для GSS-вершины $v_{j+1}$, так как $v_{j+1} = v_{m}$. Если $j < (m - 1)$, то существует путь в GSS из обнуляемых ребер, начинающийся в вершине $v_{j+1}$ и заканчивающийся в вершине $v_{m}$. Последовательность ребер в данном пути сводится к пустой строке. Так как утверждение леммы при $r = 0$ было доказано, то префикс внутреннего графа, соответствующий пути $P_{1}$, является корректным для GSS-вершины $v_{j+1}$. Теперь рассмотрим не обнуляемое ребро $e_{j}$. Если $e_{j}$~--- терминальное ребро, то оно ассоциировано с терминалом $t_{l}$. Тогда в управляющих таблицах существует операция сдвига по терминалу $t_{l}$ из состояния $v_{j+1}.state$ в состояние $v_{j}.state$. Значит, RNGLR-алгоритм, обработав строку $p_{1}$, может выполнить операцию сдвига из GSS-вершины с состоянием $v_{j+1}.state$ в вершину с состоянием $v_{j}.state$. Значит, префикс внутреннего графа, соответствующий пути $(V_{1},..,V_{l},V_{l+1})$, является корректным для GSS-вершины $v_{j}$. Если $j = 1$, то $v_{j} = v_{1}$ и утверждение леммы доказано. Пусть $j > 1$. Последовательность ребер $(e_{1},..,e_{j-1})$ за конечное число раскрытий сводится к пустой строке. Так как случай при $r = 0$ был рассмотрен, то доказано, что префикс внутреннего графа, соответствующий пути $P$, корректен для GSS-вершины $v_{1}$. Теперь пусть $e_{j}$~--- нетерминальное ребро. Покажем, что префикс внутреннего графа, соответствующий пути $P$, также является корректным и для GSS-вершины $v_{j}$. 

Рассмотрим ту конечную последовательность раскрытий, примененную к последовательности ребер $E$, после которой останется единственное терминальное ребро, ассоциированное с терминалом $t_{l}$. Существует два варианта: либо после первого применения операции раскрытия в последовательности останется единственное терминальное ребро $e_{term} = (u_{term}, v_{j+1})$, ассоциированное с терминалом $t_{l}$, либо при применении первых $i > 0$ операций раскрытия последовательность ребер GSS будет состоять из единственного нетерминального ребра, причем $\forall d \in [1,..,i],$ после применения первых $d$ операций раскрытия последовательность состоит из единственного ребра $S_{d} = (h_{d}, g_{d})$. Первый вариант означает, что префикс внутреннего графа, соответствующий пути $P = (V_{1},..,V_{l},V_{l+1})$, является корректным для GSS-вершины $u_{term}$. А так как в GSS, построенном основным анализом, существует ребро $e_{j} = (v_{j}, v_{j+1})$, ассоциированное с нетерминалом $N$ и с GSS-путем, в котором присутствует единственное ребро $e_{term}$, то префикс внутреннего графа, соответствующий пути $P$, также является корректным и для GSS-вершины $v_{j}$. Рассмотрим второй вариант. Пусть $e_{j} = S_{0} = (h_{0}, g_{0})$, тогда $\forall d \in [1,..,i],$ при применении $d$-ой операции раскрытия нетерминальное ребро $S_{d-1}$ заменяется на последовательность ребер, соответствующих одному из порожденных ребром $S_{d-1}$ пути, начинающегося в вершине $w_{d}$ и закачивающегося в вершине $g_{d-1}$, причем $w_{d}$, как и $v_{j}$, принадлежит вершине внутреннего графа $V_{l+1}$. Пусть $w_{0} = v_{j}$. Так как в данных путях ребро $S_{d}$ является единственным не обнуляемым ребром, то $\forall d \in [1,..,i],$ существует путь из вершины $w_{d}$ в вершину $h_{d}$ и существует путь из вершины $g_{d}$ в вершину $g_{d-1}$, оба из которых имеют только обнуляемые ребра. При применении $(i+1)$-ой операции раскрытия нетерминальное ребро $S_{i}$ заменятся на последовательность ребер, соответствующую пути в GSS из вершины $w_{term}$ в вершину $g_{i}$, причем в этом пути единственное не обнуляемое ребро~--- это терминальное ребро $S_{term} = (h_{term}, g_{term})$, ассоциированное с терминалом $t_{l}$. Так как $\forall d \in [1,..,i],$ существует путь из вершины $g_{d}$ в вершину $g_{d-1}$, состоящий только из обнуляемых ребер, и существует путь из вершины $g_{term}$ в вершину $g_{i}$, состоящий только из обнуляемых ребер, то также существует путь из вершины $g_{term}$ в вершину $g_{0} = v_{j+1}$ и существует путь из вершины $g_{d}$ в вершину $g_{0} = v_{j+1}$, состоящие только из обнуляемых ребер. А так как префикс внутреннего графа, соответствующий пути $P_{1}$, является корректным для GSS-вершины $v_{j+1}$, то префикс внутреннего графа, соответствующий пути $P_{1}$, также является корректным и для GSS-вершин из множества $\{g_{1},..,g_{i}, g_{term}\}$. Так как в GSS, построенным основным анализом, существует терминальное ребро $S_{term} = (h_{term}, g_{term})$, ассоциированное с терминалом $t_{l}$, то префикс внутреннего графа, соответствующий пути $P = (V_{1},..,V_{l},V_{l+1})$, является корректным для GSS-вершины $h_{term}$.  А так как существует путь из вершины $w_{term}$ в вершину $h_{term}$, то префикс внутреннего графа, соответствующий пути $P$, также является корректным и для GSS-вершины $w_{term}$. Аналогичным образом доказывается, что $\forall d \in [0,..i],$ префикс внутреннего графа, соответствующий пути $P$, является корректным для GSS-вершины $w_{d}$. А так как $w_{0} = v_{j}$, то, в частности, префикс внутреннего графа, соответствующий пути $P$, является корректным для GSS-вершины $v_{j}$.

Таким образом мы показали, что префикс внутреннего графа, соответствующий пути $P$, является корректным для GSS-вершины $v_{j}$. А так как существует путь из вершины $v_{1}$ в вершину $v_{j}$, состоящий из обнуляемых ребер, то из доказательства утверждения леммы при $r = 0$ следует, что префикс внутреннего графа, соответствующий пути $P$, также является корректным и для GSS-вершины $v_{1},$ что и доказывает утверждение леммы при $r = 1$. База индукции доказана.

\textbf{Индукционный переход.} Пусть утверждение леммы доказано для всех строк $p_{2}$ длины, меньшей $r$. Докажем утверждение леммы для строки $p_{2}$ длины $r > 1$.

Так как строка $p_{2}$ не пустая, то среди ребер в последовательности $E$ существует хотя бы одно не обнуляемое ребро. Пусть $j$ такое, что $e_{j} = (v_{j}, v_{j+1})$~--- последнее не обнуляемое ребро последовательности $E$. Если $j = (m - 1)$, то префикс внутреннего графа, соответствующий пути $P_{1}$, корректен для GSS-вершины $v_{j+1}$, так как $v_{j+1} = v_{m}$. Если $j < (m - 1)$, то существует путь в GSS из обнуляемых ребер, начинающийся в вершине $v_{j+1}$ и заканчивающийся в вершине $v_{m}$. Последовательность ребер в данном пути сводится к пустой строке. Значит, по индукционному предположению, префикс внутреннего графа, соответствующий пути $P_{1}$, является корректным для GSS-вершины $v_{j+1}$. Теперь рассмотрим не обнуляемое ребро $e_{j}$.

Если $e_{j}$~--- терминальное ребро, то оно ассоциировано с терминалом $t_{l}$. Тогда в управляющих таблицах существует операция сдвига по терминалу $t_{l}$ из состояния $v_{j+1}.state$ в состояние $v_{j}.state$. Значит, RNGLR-алгоритм, обработав строку $p_{1}$, может выполнить операцию сдвига из GSS-вершины с состоянием $v_{j+1}.state$ в вершину с состоянием $v_{j}.state$. Значит, префикс внутреннего графа, соответствующий пути $(V_{1},..,V_{l},V_{l+1})$, является корректным для GSS-вершины $v_{j}$. Так как строка $p_{2}$ имеет длину $r > 1$, то $j > 1$. Последовательность ребер $(e_{1},..,e_{j-1})$ за конечное число раскрытий сводится к строке $p_{j} = (t_{l+1},..,t_{l+r-1})$. Так как длина строки $p_{j}$ равна $(r - 1)$, то по индукционному предположению префикс внутреннего графа, соответствующий пути $P$, корректен для GSS-вершины $v_{1}$. Утверждение леммы доказано.

Если $e_{j}$~--- нетерминальное ребро. Тогда рассмотрим два случая.

Первый случай: $\exists i \in [1,..,(j-1)], e_{i}$~--- не обнуляемое ребро. Тогда ребро $e_{j}$ в последовательности $E$ после рассматриваемого конечного числа раскрытий сводится к непустой строке $(t_{l},..,t_{l+h-1})$ длины $h < r$. А так как префикс внутреннего графа, соответствующий пути $P_{1}$, является корректным для GSS-вершины $v_{j+1}$, то, по индукционному предположению, префикс внутреннего графа, соответствующий пути $(V_{1},..,V_{l},V_{l+1},..,V_{l+h})$, является корректным для GSS-вершины $v_{j}$. А так как последовательность ребер $(e_{j-1},..,e_{1})$ за конечное число раскрытий сводится к строке $(t_{l+h},..,t_{l+r-1})$ длины $(r - h) < r$, то, по индукционному предположению, префикс внутреннего графа, соответствующий пути $P$, является корректным для GSS-вершины $v_{1}$, что и доказывает утверждение леммы.

Второй случай: $\forall i \in [1,..,(j-1)], e_{i}$~--- обнуляемое ребро. Покажем, что префикс внутреннего графа, соответствующий пути $P$, также является корректным и для GSS-вершины $v_{j}$.

В данном случае $e_{j}$~--- единственное не обнуляемое ребро в последовательности $E$. Рассмотрим ту конечную последовательность раскрытий, примененную к последовательности ребер $E$, после которой остаются только терминальные ребра, причем строка, образованная инвертированием этой последовательности терминальных ребер и заменой их на терминалы, с которыми они ассоциированы, является строкой $p_{2} = (t_{l},..,t_{l+r-1})$. Существует два варианта: либо после первого применения операции раскрытия в последовательности будет более одного не обнуляемого ребра, либо при применении первых $i > 0$ операций раскрытия последовательность ребер GSS будет состоять из единственного нетерминального ребра, причем $\forall d \in [1,..,i],$ после применения первых $d$ операций раскрытия последовательность состоит из единственного ребра $S_{d} = (h_{d}, g_{d})$. Первый вариант означает, что нетерминальное ребро $e_{j}$ ассоциировано с путем $F = (x_{1},..,x_{n})$, где GSS-вершина $x_{1}$, как и вершина $v_{j}$, принадлежит вершине внутреннего графа $V_{l+r}$, а GSS-вершина $x_{n} = v_{j+1}$. Причем в пути $F$ имеется более одного не обнуляемого ребра. Найдем минимальное $y$ такое, что ребро $e_{first} = (x_{y}, x_{y+1})$ является не обнуляемым. Так как в пути $F$ имеется более одного не обнуляемого ребра, то последовательность ребер $F_{1} = ((x_{1},x_{2}),..,(x_{y},x_{y+1}))$, как и последовательность ребер $F_{2} = ((x_{y+1},x_{y+2}),..,(x_{n-1},x_{n}))$, после применения конечного числа раскрытий сводится к строке длины, меньшей $r$. Пусть последовательности ребер $F_{1}$ и $F_{2}$ сводятся за рассматриваемое конечное число раскрытий к строкам $f_{1} = (t_{l+c},..,t_{l+r-1})$ и $f_{2} = (t_{l},..,t_{l+c-1})$, где $0 < c < r$. Так как $x_{n} = v_{j+1}$, то по индукционному предположению префикс внутреннего графа, соответствующий пути $(V_{1},..,V_{l+c})$, является корректным для GSS-вершины $x_{y+1}$. Это, в свою очередь, означает, что префикс внутреннего графа, соответствующий пути $P = (V_{1},..,V_{l+r})$, является корректным для GSS-вершины $x_{1}$. А так как в GSS, построенным основным анализом, существует ребро $e_{j} = (v_{j}, v_{j+1})$, ассоциированное с GSS путем $F$, то префикс внутреннего графа, соответствующий пути $P = (V_{1},..,V_{l+r})$, является также корректным и для GSS-вершины $v_{j}$. Рассмотрим второй вариант. Аналогично рассуждениям в базе индукции при $r = 1$, конструируем множества $\{S_{0},..,S_{i}\},\{w_{0},..,w_{i}\}, \{h_{0},..,h_{i}\}, \{g_{0},..,g_{i}\}$. При применении $(i+1)$-ой операции раскрытия нетерминальное ребро $S_{i}$ заменятся на последовательность ребер, соответствующую пути $R$ в GSS из вершины $r_{1}$ в вершину $g_{i}$, причем в пути $R$ существует более одного не обнуляемого ребра. GSS-вершина $r_{1}$, как и вершина $v_{j}$, принадлежит вершине внутреннего графа $V_{l+r}$. Применив к пути $R$, рассуждения, аналогичные рассуждениям при рассмотрении пути $F$, получим, что префикс внутреннего графа, соответствующий пути $P$, является корректным для любой GSS-вершины из множества $\{w_{0},..,w_{i},r_{1}\}$, а так как $w_{0} = v_{j}$, то, в частности, префикс внутреннего графа, соответствующий пути $P$, является корректным для GSS-вершины $v_{j}$.

Таким образом показали, что префикс внутреннего графа, соответствующий пути $P$, является корректным для GSS-вершины $v_{j}$. А так как существует путь из вершины $v_{1}$ в вершину $v_{j}$, состоящий из обнуляемых ребер, то по индукционному предположению префикс внутреннего графа, соответствующий пути $P$, также является корректным и для GSS-вершины $v_{1},$ что и доказывает утверждение леммы.
$\square$

\textsc{Теорема 2.} 
\textit{Каждый префикс внутреннего графа, соответствующий пути $P = (V_{1},..,V_{l})$ внутреннего графа и порождаемый графом префиксов $v.prefixes$, является корректным для GSS-вершины $v$.}

\textsc{Доказательство.}
Пусть $p$~--- строка, образованная из терминалов на ребрах пути $P$. Длина строки $p$ равна $(l-1)$. Так как префикс внутреннего графа, соответствующий пути $P$, порождается графом префиксов $v.prefixes$, то в этом графе префиксов существует путь $X$ из одной из начальных вершин графа префиксов $v.prefixes$ в вершину $EOP$, который сводится к строке $p$.

Если путь $X$ состоит из единственной вершины $EOP$, то она является начальной вершиной графа префиксов $v.prefixes$, а значит $v$~--- начальная вершина GSS. А так как путь $X$ в графе префиксов $v.prefixes$ сводится к пустой строке, то строка $p$~--- пустая, и путь $P$ состоит из единственной начальной вершины внутреннего графа $V_{1}$. Значит, префикс внутреннего графа, соответствующий пути $P$, корректен для начальной вершины GSS, которой является вершина $v$.

Пусть путь $X = (E_{1},..,E_{m},EOP)$, где $m > 0$ и $E_{1}$~--- одна из начальных вершин графа префиксов $v.prefixes$. Из построения графов префиксов следует, что существует путь из GSS-вершины $v$ в начальную GSS-вершину $v_{0}$. Причем последовательность ребер в данном пути после конечного числа раскрытий сводится к строке $p$. А так как префикс внутреннего графа, соответствующий пути $F = (V_{1})$, корректен для начальной GSS-вершины $v_{0}$ и существует путь из GSS-вершины $v$ в GSS-вершину $v_{0}$, в котором последовательность ребер сводится за конечное число раскрытий к строке $p$, то, по \textsc{лемме}, префикс внутреннего графа, соответствующий пути $P = (V_{1},..,V_{l})$, является корректным для GSS-вершины $v$.
$\square$

\subsection{Корректность алгоритма диагностики ошибок}
В данном разделе приведено доказательство того, что любое ребро $e$ внутреннего графа из множества $errors$ является ошибочными, а все ошибочные ребра принадлежат множеству $errors \cup probErrors$. Также будет доказано, что любой префикс внутреннего графа, порождаемый графом префиксов из множества $errors[e]$, является корректным, но при добавлении к данному префиксу в конец ребра $e$ образуется некорректный префикс внутреннего графа, а все такие префиксы порождаются хотя бы одним графом префиксов из множества $errors[e] \cup probErrors[e]$.

\textsc{Теорема 3.}
\textit{После работы алгоритма диагностики ошибок любое ребро $e$ внутреннего графа из множества $errors$ является ошибочными. А любой префикс внутреннего графа, порождаемый графом префиксов из множества $errors[e]$, является корректным, но при добавлении к данному префиксу в конец ребра $e$ образуется некорректный префикс внутреннего графа.}

\textsc{Доказательство.}
Докажем, что ребро $e$ является ошибочным, методом от противного. Пусть ребро внутреннего графа $e \in errors$ не является ошибочным. Пусть ребро $e$ нагружено терминалом $t$, исходит из вершины внутреннего графа $V_{l}$ и входит в вершину $V_{l+1}$. Обозначим входную эталонную грамматику через $G$. Рассмотрим два случая.

Если $V_{l+1}$~--- не конечная вершина внутреннего графа. Пусть $(e_{1},..,e_{n})$~--- терминальные ребра GSS, ассоциированные с терминалом $t$, причем $\forall i \in [1,..,n], e_{i} = (x_{i},y_{i})$, где $x_{i}$ принадлежит вершине $V_{l+1}$, а $y_{i}$ принадлежит вершине $V_{l}$. Пусть GSS-вершина $v$, принадлежащая вершине внутреннего графа $V_{l}$, принадлежит множеству $Z$, если $\forall i \in [1,..,n], v \neq y_{i}$. Так как $e \in errors$, то $\exists v \in Z$~--- GSS-вершина, такая, что $v.prefixes$ порождает некоторый префикс внутреннего графа, который не порождается графом префиксов $y_{i}.prefixes, \forall i \in [1,..,n]$. Множество всех таких префиксов внутреннего графа обозначим $K$. Пусть один из префиксов внутреннего графа множества $K$ соответствует пути $P = (V_{1},..,V_{l})$. Пусть $p$~--- строка, образованная последовательностью терминалов на пути $P$. Так как $v.prefixes$ порождает префикс внутреннего графа, соответствующий пути $P$, то, по \textsc{теореме 2}, получаем, что этот префикс является корректным для GSS-вершины $v$. Значит, строка $p$ является корректным префиксом для грамматики $G$. Пусть $Q$~--- множество GSS-вершин, для которых префикс внутреннего графа, соответствующий пути $P$, является корректным. Так как рассматриваемый префикс внутреннего графа не порождается графом префиксов $y_{i}.prefixes, \forall i \in [1,..,n]$, то, по \textsc{теореме 1}, данный префикс не является корректным для GSS-вершины $y_{i}, \forall i \in [1,..,n]$. Значит, $\forall i \in [1,..,n], y_{i} \notin Q$. Поэтому $\forall q \in Q,$ в управляющих таблицах не существует операции сдвига из состояния $q.state$ по терминалу $t$. Значит, RNGLR-алгоритм, обработав все терминалы строки $p$ и получив следующим терминалом входной строки терминал $t$, не сможет сделать ни одной операции сдвига по данному терминалу. Таким образом, префикс внутреннего графа, соответствующий пути $P = (V_{1},..,V_{l},V_{l+1})$, не является корректным. Значит, ребро $e$ является ошибочным. Получили противоречие.

Если $V_{l+1}$~--- конечная вершина внутреннего графа, тогда $t$ является специальным терминалом $EOF$ конца строки. Пусть $A_{1}$~--- множество GSS-вершин, принадлежащих вершине $V_{l}$ и имеющих принимающее состояние, а $A_{2}$~--- множество GSS-вершин, принадлежащих вершине $V_{l}$ и имеющих непринимающее состояние. Так как $e \in errors$, то существует GSS-вершина $v \in A_{2}$ такая, что граф префиксов $v.prefixes$ порождает некоторый корректный префикс внутреннего графа, который не порождается ни одним графом префиксов GSS-вершин из множества $A_{1}$. Множество всех таких префиксов внутреннего графа обозначим $L$. Пусть один из префиксов внутреннего графа множества $L$ соответствует пути $F = (V_{1},..,V_{l})$. Пусть $f$~--- строка, образованная последовательностью терминалов на пути $F$. По \textsc{теореме 2}, данный префикс внутреннего графа является корректным для GSS-вершины $v$, так как он порождается графом префиксов $v.prefixes$. Значит, префикс внутреннего графа, соответствующий пути $F$, является корректным. А так как графы префиксов GSS-вершин из множества $A_{1}$ не порождают префикс внутреннего графа, соответствующий пути $F$, то, по \textsc{теореме 1}, рассматриваемый префикс внутреннего графа не является корректным ни для одной GSS-вершины из множества $A_{1}$. Значит, RNGLR-алгоритм, обработав все терминалы строки $f$, на последнем уровне GSS не будет иметь ни одной вершины с принимающим состоянием. Значит, строка $f$ не является принимаемой грамматикой $G$. Таким образом, ребро $e$ является ошибочным. Получили противоречие.

В случае, когда $V_{l+1}$ не является конечной вершиной внутреннего графа, префикс внутреннего графа, соответствующий пути $P = (V_{1},..,V_{l})$, взят из множества $K$ произвольным образом. Для этого префикса показано, что он является корректным, но при добавлении к данному префиксу в конец ребра $e$ образуется некорректный префикс внутреннего графа. Из построения множества графов префиксов $errors[e]$ следует, что данные графы префиксов порождают префиксы внутреннего графа из множества $K$ и только их. Таким образом, любой префикс внутреннего графа, порождаемый одним из графов префиксов $errors[e]$, является корректным, но при добавлении к нему в конец ребра $e$ образуется некорректный префикс внутреннего графа. Аналогично, данное утверждение доказывается в случае, если $V_{l+1}$~--- конечная вершина внутреннего графа с множеством префиксов внутреннего графа равным $L$.
$\square$

\textsc{Теорема 4.}
\textit{После работы алгоритма диагностики ошибок любое ошибочное ребро $e$ внутреннего графа, исходящее из вершины $V_{l}$ и входящее в вершину $V_{l+1}$, принадлежит объединению множеств $errors$ и $probErrors$. А любой префикс внутреннего графа, заканчивающийся в вершине $V_{l}$ и становящийся некорректным при добавлении в конец ребра $e$, порождается хотя бы одним графом префиксов из объединения множеств $errors[e]$ и $probErrors[e]$.}

\textsc{Доказательство.}
Пусть ребро $e$ нагружено терминалом $t$. Пусть $L$~--- множество всех префиксов внутреннего графа, заканчивающихся в вершине $V_{l}$ и становящихся некорректным при добавлении в конец ребра $e$. Так как ребро $e$ является ошибочным, то множество $L$ не пусто. Рассмотрим префикс внутреннего графа из множества $L$. Пусть этому префиксу соответствует путь внутреннего графа $P = (V_{1},..,V_{l})$. Пусть $p$~--- строка, получающаяся заменой в последовательности ребер в пути $P$ на терминалы, которыми нагружены соответствующие ребра. Так как данный префикс внутреннего графа является корректным, то существует GSS-вершина $v$, принадлежащая вершине внутреннего графа $V_{l}$, такая, что рассматриваемый префикс является корректным для вершины $v$. По \textsc{теореме 1}, данный префикс внутреннего графа порождается графом префиксов $v.prefixes$. Обозначим через $G$ входную эталонную грамматику. Рассмотрим два случая.

Если $V_{l+1}$~--- не конечная вершина внутреннего графа. Пусть $(e_{1},..,e_{n})$~--- терминальные ребра GSS, ассоциированные с терминалом $t$, причем $\forall i \in [1,..,n], e_{i} = (x_{i},y_{i})$, где $x_{i}$ принадлежит вершине $V_{l+1}$, а $y_{i}$ принадлежит вершине $V_{l}$. Пусть GSS-вершина $u$, принадлежащая вершине внутреннего графа $V_{l}$, принадлежит множеству $Z$, если $\forall i \in [1,..,n], u \neq y_{i}$. Так как один из префиксов, порождаемых графом префиксов $v.prefixes$, становится некорректным при добавлении в конец ребра $e$, то $v \in Z$. Если граф префиксов $v.prefixes$ имеет цикл, то ребро $e \in probErrors$, а префикс внутреннего графа, соответствующий пути $P$, порождается одним из графов префиксов множества $probErrors[e]$. Пусть граф префиксов $v.prefixes$ не имеет циклов. В виду того, что рассматриваемый префикс внутреннего графа становится некорректным при добавлении в конец ребра $e$, то $\forall i \in [1,..,n], y_{i}.prefixes$ не порождает данный префикс. Если $\exists i \in [1,..,n]$ такое, что граф префиксов $y_{i}.prefixes$ имеет цикл, то $e \in probErrors$, а префикс внутреннего графа, соответствующий пути $P$, порождается одним из графов префиксов множества $probErrors[e]$. Если такого $i$ не существует, то $e \in errors$, а префикс внутреннего графа, соответствующий пути $P$, порождается одним из графов префиксов множества $errors[e]$. Таким образом, в данном случае,  $e \in errors \cup probErrors$, а префикс внутреннего графа, соответствующий пути $P$, порождается одним из графов префиксов множества $errors[e] \cup probErrors[e]$.

Если $V_{l+1}$~--- конечная вершина внутреннего графа, тогда $t$ является специальным терминалом $EOF$ конца строки. Пусть $A_{1}$~--- множество GSS-вершин, принадлежащих вершине $V_{l}$, и имеющих принимающее состояние, а $A_{2}$~--- множество GSS-вершин, принадлежащих вершине $V_{l}$, и имеющих непринимающее состояние. Так как один из префиксов, порождаемых графом префиксов $v.prefixes$, становится некорректным при добавлении в конец ребра $e$, то $v \in A_{2}$. Если граф префиксов $v.prefixes$ имеет цикл, то ребро $e \in probErrors$, а префикс внутреннего графа, соответствующий пути $P$, порождается одним из графов префиксов множества $probErrors[e]$. Пусть граф префиксов $v.prefixes$ не имеет циклов. Ввиду того, что рассматриваемый префикс внутреннего графа становится некорректным при добавлении в конец ребра $e$, то $\forall z \in A_{1}, z.prefixes$ не порождает данный префикс. Если $\exists z \in A_{1}$ такое, что граф префиксов $z.prefixes$ имеет цикл, то $e \in probErrors$, а префикс внутреннего графа, соответствующий пути $P$, порождается одним из графов префиксов множества $probErrors[e]$. Если такого $z$ не существует, то $e \in errors$, а префикс внутреннего графа, соответствующий пути $P$, порождается одним из графов префиксов множества $errors[e]$.

Таким образом, во всех случаях $e \in errors \cup probErrors$, а префикс внутреннего графа, соответствующий пути $P$, порождается одним из графов префиксов множества $errors[e] \cup probErrors[e]$. Так как префикс внутреннего графа, соответствующий пути $P$, выбирался из множества $L$ произвольным образом, то утверждение теоремы доказано.
$\square$
