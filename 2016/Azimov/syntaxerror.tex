
\section{Понятие синтаксической ошибки}
Прежде чем описывать алгоритм диагностики ошибок, необходимо определить понятие синтаксической ошибки для алгоритма ослабленного синтаксического анализа регулярной аппроксимации динамически формируемого выражения. На вход данного алгоритма подается не одна строка, а множество строк, поэтому необходимо обнаруживать ошибки во всех строках из данного множества. Для этого необходимо определить понятие синтаксической ошибки для алгоритма RNGLR. Определим сначала понятие синтаксической ошибки для GLR-алгоритма.

GLR-алгоритм, получивший на вход строку, не принимаемую соответствующей грамматикой, останавливает свою работу в двух случаях:
\begin{itemize}
    \item синтаксический анализатор обработал всю входную строку, но среди множества итоговых состояний ни одно состояние не принадлежит множеству принимающих состояний;
    \item синтаксический анализатор выполнил все операции свертки для текущего терминала, но среди множества состояний текущего уровня не имеется ни одного состояния, по которому в управляющей таблице существует операция сдвига к следующему терминалу входной строки.
\end{itemize}

Таким образом, пока обработанная часть входной строки является корректным префиксом данной грамматики, хотя бы один стек из множества стеков состояний текущего уровня может быть продолжен с использованием операции сдвига к следующему терминалу входной строки. Другими словами, GLR-алгоритм, как и алгоритмы LR-семейства, обладает свойством корректного префикса. \emph{Ошибочным терминалом} входной строки GLR-алгоритма будем называть первый терминал из необработанной части входной строки на момент обнаружения синтаксической ошибки (если обработана вся строка, то это специальный терминал, обозначающий конец строки).

Алгоритм RNGLR также обладает свойством корректного префикса, т.к. является расширением GLR-алгоритма со специальной обработкой некоторых правил входной грамматики. Определение \emph{ошибочного терминала} входной строки RNGLR-алгоритма аналогично определению ошибочного терминала GLR алгоритма.

Ввиду того, что алгоритм ослабленного синтаксического анализа регулярной аппроксимации динамически формируемого выражения, в отличие от RNGLR-алгоритма, принимает на вход не строку, а множество строк, то необходимо искать синтаксические ошибки во всем входном множестве строк. Для каждой отдельной строки понятие синтаксической ошибки совпадает с понятием синтаксической ошибки в RNGLR-алгоритме. Множество входных строк выражено конечным недетерминированным автоматом с единственными начальным и конечным состояниями. Данный автомат представляется в виде ориентированного графа (внутреннего графа) с терминалами на ребрах. В таком случае, обработанная часть входных данных --– не префикс строки, а терминалы, ассоциированные с ребрами (то есть нагруженные на ребрах) в пути во внутреннем графе из начальной вершины в вершину, соответствующую текущему уровню. Рассматриваемый путь будем называть \emph{префиксом внутреннего графа}. Если строка $p$, образованная терминалами на ребрах рассматриваемого пути префикса внутреннего графа $P$, является корректным префиксом эталонной грамматики, то префикс внутреннего графа $P$ назовем \emph{корректным}, иначе~--- \emph{некорректным}.

Пусть непустая строка $p$ является корректным префиксом для рассматриваемой грамматики, тогда при обработке данной строки RNGLR-алгоритмом будут прочитаны все её терминалы и на последнем уровне GSS будет хотя бы одна вершина. Пусть $(s_{1},..,s_{n})$~--- все состояния вершин рассматриваемого последнего уровня GSS. Тогда в последней вершине $V$ пути префикса внутреннего графа $P$ $\exists (v_{1},..,v_{n})$~--- GSS-вершины, где $v_{i}.state = s_{i}, \forall i \in [1,..,n]$. Префикс внутреннего графа $P$ назовем \emph{корректным для GSS-вершины $v$}, если $v \in (v_{1},..,v_{n})$.  Если строка $p$ пустая и она является корректным префиксом для рассматриваемой грамматики, то префикс внутреннего графа $P$ состоит из единственной начальной вершины внутреннего графа; назовем его корректным для GSS-вершин $(u_{1},..,u_{n})$, где $\forall i, u_{i}$~--- либо начальная GSS-вершина, либо существует последовательность сверток длины 0, приводящая парсер из начального состояния в состояние $u_{i}.state$.

Назовем \emph{ошибочным ребром} ребро внутреннего графа $e$, которое не нагружено специальным терминалом конца строки $EOF$, такое, что существует хотя бы один корректный префикс внутреннего графа $P$, заканчивающийся в вершине, из которой исходит данное ребро, но при добавлении ребра $e$ в конец префикса $P$ образуется некорректный префикс внутреннего графа. Если ребро $e$ нагружено терминалом конца строки $EOF$, то ребро $e$ является \emph{ошибочным}, если существует хотя бы один корректный префикс внутреннего графа $P$, заканчивающийся в вершине, из которой исходит данное ребро, но строка, образованная последовательностью терминалов на ребрах пути $P$, не является принимаемой эталонной грамматикой. Аналогом ошибочного терминала во входной строке RNGLR-алгоритма является ошибочное ребро внутреннего графа.
% * <Екатерина Вербицкая> 14:01:14 13 May 2016 UTC+0300:
% И сюда бы примеры, желательно картинками.

Таким образом, цель диагностики ошибок в рамках синтаксического анализа регулярной аппроксимации множества значений динамически формируемого выражения заключается в обнаружении ошибочных ребер внутреннего графа и выводе корректных префиксов внутреннего графа, заканчивающихся в вершине, из которой исходит рассматриваемое ошибочное ребро, и становящихся некорректными при добавлении в конец этого ребра.
% * <Екатерина Вербицкая> 14:05:19 13 May 2016 UTC+0300:
% Опять же, каких ошибочных ребер? Первого попавшегося? Всех? Подмножество? Надмножество?
% ^ <Рустам Азимов> 15:34:36 13 May 2016 UTC+0300:
% Ребро по данному определению либо ошибочное либо нет. Необходимо выяснять для каждого ребра, является ли оно ошибочным. После окажется что для всех ребер не можем определить.
